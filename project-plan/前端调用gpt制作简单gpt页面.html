<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Rspress v1.43.9">
    <title data-rh="true">前端调用gpt制作简单gpt页面 - akira-blog</title>
  <script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/rspress-icon.png"><script defer src="/static/js/styles.cb278b64.js"></script><script defer src="/static/js/lib-react.509de283.js"></script><script defer src="/static/js/lib-router.9c922211.js"></script><script defer src="/static/js/121.114bc26a.js"></script><script defer src="/static/js/index.bf0d6a25.js"></script><link href="/static/css/styles.f50526a2.css" rel="stylesheet"></head>

  <body >
    <div id="root"><div class="navContainer_d18b1 rspress-nav px-6  sticky_ddfa7"><div class="container_e4235 flex justify-between items-center h-full"><div class="navBarTitle_c5f07"><a class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><div class="mr-1 min-w-8"><img src="/rspress-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/rspress-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_a2fea"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_df1fb"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg><p class="searchWord_af2c1">Search Docs</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_d85a9"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a class="link_a7cea  cursor-pointer" target="" href="/dify/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">dify</div></a><a class="link_a7cea  cursor-pointer" target="" href="/antd-design/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">antd-design</div></a><a class="link_a7cea  cursor-pointer" target="" href="/large-screen/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">数字大屏</div></a><a class="link_a7cea  cursor-pointer" target="" href="/project-plan/index.html"><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center">解决方案</div></a><a class="link_a7cea  cursor-pointer" target="" href="/about/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于作者</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6m0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4M12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3M19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3M3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3M18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5s.2.8-.1 1.1c-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2M9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2"></path></svg></div></div></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/akira0912" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a></div></div></div></div><div class="mobileNavMenu_e7045"><div class="navScreen_ec30c  rspress-nav-screen" id="navScreen"><div class="container_c935d"><div class="navMenu_b887b"><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/dify/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">dify</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/antd-design/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">antd-design</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/large-screen/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">数字大屏</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/project-plan/index.html"><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center">解决方案</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/about/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于作者</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_bf893 flex justify-center"></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/akira0912" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a></div></div></div></div></div><button aria-label="mobile hamburger" class=" rspress-mobile-hamburger navHamburger_ac64c text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_af141 pt-0"><aside class="sidebar_dd719 rspress-sidebar "><div class="navTitleMask_fb17c"><div class="navBarTitle_c5f07"><a class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><div class="mr-1 min-w-8"><img src="/rspress-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/rspress-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div></div><div class="rspress-scrollbar sidebarContent_da296"><nav class="pb-2"><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/iframe的加载时展示loading动画&amp;动态加载路由（伪）.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>iframe的加载时展示loading动画&amp;动态加载路由（伪）</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/index.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>index</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/zxing识别二维码和条形码.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>一、了解几个识别库</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/前端文件的预览和打印-HTML打印-HTML转pdf.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>前端文件的预览和打印/HTML打印/HTML转pdf</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/前端调用gpt制作简单gpt页面.html"><div class="menuItemActive_de63c mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>前端调用gpt制作简单gpt页面</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/文件的上传与导出.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>文件的上传与导出</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/用flex布局写骰子.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>用flex布局写骰子</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/表单的实时保存（断网、离开页面前保存等情况）.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>表单的实时保存（断网、离开页面前保存等情况）</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/记录vue2图片上传的过程.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>记录vue2图片上传的过程</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/project-plan/需求：能不能直接粘贴图片到文本框中.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>需求：能不能直接粘贴图片到文本框中</span></div></a></nav></div></aside><div class="flex-1 relative min-w-0"><div class="rspress-sidebar-menu-container no-toc"><div class="rspress-sidebar-menu"><button type="button" class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button></div></div><div class="content_ff766 rspress-doc-container flex"><div class="flex-1 overflow-x-auto"><div class="rspress-doc"><!--$--><h1 id="前端调用gpt制作简单gpt页面" class="rspress-doc-title text-3xl mb-10 leading-10 tracking-tight title_fb7eb">前端调用gpt制作简单gpt页面<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#前端调用gpt制作简单gpt页面">#</a></h1>
<p class="my-4 leading-7">写一个简单的聊天页面，使用<strong class="font-semibold">SSE</strong>调用ChatGPT的接口，使用<strong class="font-semibold">react-markdown</strong>显示获取到的数据。</p>
<p class="my-4 leading-7">又来水一篇文章。后端小伙伴对于ai一直很感兴趣，想在公司的综合平台里用gpt集成知识库，让同事都可以免费使用gpt4。研究了一下，了解了一点SSE的知识点。（只是想法，自己写着玩儿，上线的话还需要考虑很多东西）</p>
<p class="my-4 leading-7">ChatGPT的打字机效果是使用SSE（Server-Sent Events）获取流式数据实现的。SSE与websocket是单向的，服务器可以主动向浏览器发送数据，但是浏览器不能向服务器发。SSE基于HTTP，而websocket是有另外的协议的，所以SSE的兼容性更好一点。</p>
<p class="my-4 leading-7">原生的EventSource直接发送get请求，我们想发post请求可以用封装过的@microsoft/fetch-event-source</p>
<p class="my-4 leading-7">react-markdown是一个基于react的markdown解析器组件，可以在组件中直接渲染markdown格式的内容，然后通过其他插件可以给这个元素加各种样式。</p>
<p class="my-4 leading-7">js</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code>import { Button, Col, Input, Row } from &#x27;antd&#x27;; import React, { useEffect, useRef, useState } from &#x27;react&#x27;; import { fetchEventSource } from &#x27;@microsoft/fetch-event-source&#x27;; import { PageContainer } from &#x27;@ant-design/pro-layout&#x27;; import ProCard from &#x27;@ant-design/pro-card&#x27;; import styles from &#x27;./index.less&#x27;; import { SearchOutlined } from &#x27;@ant-design/icons&#x27;; import { useModel } from &#x27;umi&#x27;; import ReactMarkdown from &#x27;react-markdown&#x27;; import remarkGfm from &#x27;remark-gfm&#x27;; // 划线、表、任务列表和直接url等的语法扩展 import rehypeRaw from &#x27;rehype-raw&#x27;; // 解析标签，支持html语法 import { Prism as SyntaxHighlighter } from &#x27;react-syntax-highlighter&#x27;; // 代码高亮 //高亮的主题，还有很多别的主题，可以自行选择 import { tomorrow } from &#x27;react-syntax-highlighter/dist/esm/styles/prism&#x27;; import { v4 as uuidv4 } from &#x27;uuid&#x27;; import &#x27;github-markdown-css&#x27;; const AIChat: React.FC = () =&gt; {   const [inputValue, setInputValue] = useState&lt;string&gt;(&#x27;&#x27;);   const [loading, setLoading] = useState&lt;boolean&gt;(false); //控制是否能input   const stopReading = useRef&lt;boolean&gt;(false);   const [chatData, setChatData] = useState&lt;Record&lt;string, any&gt;[]&gt;([     { id: -1, content: &#x27;你好，请输入你的问题。&#x27; },   ]);   const { initialState } = useModel(&#x27;@@initialState&#x27;);   const { currentUser } = initialState || {};   const count = useRef&lt;number&gt;(0);   const [tempContent, setTempContent] = useState&lt;string&gt;(&#x27;&#x27;);   const tempContent2 = useRef&lt;string&gt;(&#x27;&#x27;);   useEffect(() =&gt; {     if (localStorage.getItem(&#x27;chatData&#x27;)) {       setChatData(JSON.parse(localStorage.getItem(&#x27;chatData&#x27;) || &#x27;&#x27;));     }   }, []);   const ctrl = new AbortController();   const fetchEventGPT = () =&gt; {     setChatData([       ...chatData,       { id: uuidv4(), content: inputValue, roles: &#x27;user&#x27; },       { id: uuidv4(), content: &#x27;&#x27;, roles: &#x27;gpt&#x27; },     ]);     count.current += 2;     setInputValue(&#x27;&#x27;);     setTempContent(&#x27;&#x27;);     tempContent2.current = &#x27;&#x27;;     setLoading(true);     // const data = {     //   channelId: &#x27;1220648311464267808&#x27;,     //   messages: [     //     {     //       content: inputValue,     //       role: &#x27;user&#x27;,     //     },     //   ],     //   model: &#x27;GPT-3.5&#x27;,     //   stream: true,     // };     const data = {       content: inputValue,     };     //换成gpt的接口     fetchEventSource(&#x27;http://192.168.200.207:8123/gpt/chat&#x27;, {       method: &#x27;POST&#x27;,       headers: {         &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,       },       body: JSON.stringify(data),       signal: ctrl.signal,       async onopen(response) {         if (response.ok &amp;&amp; response.status === 200) {           console.log(&#x27;open&#x27;);         }       },       onmessage(msg) {         if (stopReading.current) {           console.log(&#x27;stop&#x27;);           return;         }         if (msg.data === &#x27;{&quot;event&quot;:&quot;done&quot;}&#x27;) {           console.log(&#x27;done&#x27;);           let temp: Record&lt;string, any&gt;[] = [];           setChatData((pre) =&gt; {             pre[pre.length - 1].content = tempContent2.current;             temp = pre;             return temp;           });           localStorage.setItem(&#x27;chatData&#x27;, JSON.stringify(temp));           return;         }         if (msg.data) {           try {             const datas = JSON.parse(msg.data);             const { message } = datas;             if (message?.type === &#x27;answer&#x27; &amp;&amp; message?.content) {               tempContent2.current = tempContent2.current + message?.content;               setTempContent(tempContent2.current);             }             // if (datas.event === &#x27;error&#x27;) {             //   setTempContent(&#x27;出错了，&#x27; + datas?.error_information?.err_msg || &#x27;请联系管理员。&#x27;);             // }           } catch (error) {             console.log(error);           }         }       },       onclose() {         console.log(&#x27;close&#x27;);         stopReading.current = false;         setLoading(false);         ctrl.abort();       },       onerror(err) {         console.log(&#x27;error&#x27;, err);         stopReading.current = false;         setLoading(false);         ctrl.abort();         // source?.close();       },     });   };   const suffix = (     &lt;SearchOutlined       style={{         fontSize: 16,       }}       onClick={fetchEventGPT}     /&gt;   );   return (     &lt;&gt;       &lt;PageContainer title={false} style={{ height: &#x27;100%&#x27; }}&gt;         &lt;ProCard style={{ marginBottom: 20, borderRadius: 5 }}&gt;           &lt;div className={styles.gptContent}&gt;             {chatData &amp;&amp; chatData.length &gt; 0 &amp;&amp; (               &lt;&gt;                 {chatData.map((item) =&gt; {                   return (                     &lt;Row key={item.id} gutter={[24, 24]} style={{ marginBottom: 18 }}&gt;                       {item.roles === &#x27;user&#x27; ? (                         &lt;&gt;                           &lt;Col&gt;                             &lt;img                               src={                                 currentUser?.headImgUrl ||                                 &#x27;https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png&#x27;                               }                               alt=&quot;&quot;                               className={styles.imgStyle}                             /&gt;                           &lt;/Col&gt;                           &lt;Col                             span={20}                             style={{                               border: &#x27;1px solid #cfd3d3&#x27;,                               borderRadius: &#x27;10px&#x27;,                               width: &#x27;100%&#x27;,                               minHeight: &#x27;30px&#x27;,                               backgroundColor: &#x27;rgb(93,92,222)&#x27;,                               color: &#x27;#fff&#x27;,                               display: &#x27;flex&#x27;,                               justifyContent: &#x27;flex-start&#x27;,                               alignItems: &#x27;center&#x27;,                               fontSize: 16,                             }}                           &gt;                             &lt;div id={item.id} style={{ padding: &#x27;5 2&#x27; }}&gt;                               {item.content}                             &lt;/div&gt;                           &lt;/Col&gt;                         &lt;/&gt;                       ) : (                         &lt;&gt;                           &lt;Col&gt;                             &lt;img                               src={                                 &#x27;https://psc2.cf2.poecdn.net/assets/_next/static/media/assistant.b077c338.svg&#x27;                               }                               alt=&quot;&quot;                               className={styles.imgStyle}                             /&gt;                           &lt;/Col&gt;                           &lt;Col                             span={20}                             style={{                               border: &#x27;1px solid #cfd3d3&#x27;,                               borderRadius: &#x27;10px&#x27;,                               width: &#x27;100%&#x27;,                               minHeight: &#x27;30px&#x27;,                             }}                           &gt;                             &lt;ReactMarkdown                               className=&quot;markdown-body&quot;                               remarkPlugins={[remarkGfm]}                               rehypePlugins={[rehypeRaw]}                               components={{                                 img(props) {                                   return &lt;img {...props} style={{ maxWidth: &#x27;100%&#x27; }} /&gt;;                                 },                                 code({ className, children, ...props }) {                                   const match = /language-(\w+)/.exec(className || &#x27;&#x27;);                                   return match ? (                                     &lt;SyntaxHighlighter                                       style={tomorrow}                                       language={match[1]}                                       PreTag=&quot;div&quot;                                       {...props}                                     &gt;                                       {String(children).replace(/\n$/, &#x27;&#x27;)}                                     &lt;/SyntaxHighlighter&gt;                                   ) : (                                     &lt;code className={className} {...props}&gt;                                       {children}                                     &lt;/code&gt;                                   );                                 },                               }}                             &gt;                               {item.content ? item.content : tempContent}                             &lt;/ReactMarkdown&gt;                             {/* &lt;ReactMarkdown                               remarkPlugins={[remarkGfm]}                               rehypePlugins={[rehypeHighlight]}                               style={{ marginBottom: 0 }}                             &gt;                               {item.content ? item.content : tempContent}                             &lt;/ReactMarkdown&gt; */}                           &lt;/Col&gt;                         &lt;/&gt;                       )}                     &lt;/Row&gt;                   );                 })}               &lt;/&gt;             )}           &lt;/div&gt;           &lt;Button             style={{ display: loading ? &#x27;&#x27; : &#x27;none&#x27; }}             onClick={() =&gt; {               stopReading.current = true;               ctrl.abort();             }}           &gt;             Stop           &lt;/Button&gt;           &lt;Input             size={&#x27;large&#x27;}             type=&quot;textarea&quot;             placeholder=&quot;与Assistant交谈&quot;             className={styles.chatInput}             suffix={suffix}             value={inputValue}             onChange={(e) =&gt; {               setInputValue(e.target.value);             }}             onPressEnter={fetchEventGPT}             disabled={loading}           /&gt;         &lt;/ProCard&gt;       &lt;/PageContainer&gt;     &lt;/&gt;   ); }; export default AIChat;</code></p>
<p class="my-4 leading-7">做了上下文的缓存，样式还有没写好的地方，没有做到poe那样，有空再继续完善。</p>
<p class="my-4 leading-7"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f686c9c5103b47f298b3434e5f7c733a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=913&amp;h=783&amp;s=77745&amp;e=png&amp;b=fbfbfb" alt="1def611d1850f660a4195ac484ccf4f.png"/></p>
<p class="my-4 leading-7"><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/516951fef17a4bc1b23e1c46d997469f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=616&amp;h=483&amp;s=36552&amp;e=png&amp;b=ffffff" alt="128022e787f3db2c6af3afc294cb09e.png"/></p>
<p class="my-4 leading-7">两种markdown的样式</p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_c92d1 flex flex-col"><a class="link_a7cea pager-link_e0d2d cursor-pointer" target="" href="/project-plan/前端文件的预览和打印-HTML打印-HTML转pdf.html"><span class="desc_dcc01">Previous Page</span><span class="title_a3acb">前端文件的预览和打印/HTML打印/HTML转pdf</span></a></div><div class="next_c11be flex flex-col"><a class="link_a7cea pager-link_e0d2d next_ad355 cursor-pointer" target="" href="/project-plan/文件的上传与导出.html"><span class="desc_dcc01">Next Page</span><span class="title_a3acb">文件的上传与导出</span></a></div></div></footer></div></div></div></div></div></section></div>
    <div id="search-container"></div>
  </body>
</html>
