<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Rspress v1.43.9">
    <title data-rh="true">akira-blog</title>
  <script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/blog/rspress-icon.png"><script defer src="/blog/static/js/styles.cb278b64.js"></script><script defer src="/blog/static/js/lib-react.509de283.js"></script><script defer src="/blog/static/js/lib-router.9c922211.js"></script><script defer src="/blog/static/js/121.af252e41.js"></script><script defer src="/blog/static/js/index.106e0a4c.js"></script><link href="/blog/static/css/styles.f50526a2.css" rel="stylesheet"></head>

  <body >
    <div id="root"><div class="navContainer_d18b1 rspress-nav px-6  sticky_ddfa7"><div class="container_e4235 flex justify-between items-center h-full"><div class="navBarTitle_c5f07"><a class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/blog/index.html"><div class="mr-1 min-w-8"><img src="/blog/rspress-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/blog/rspress-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_a2fea"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_df1fb"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg><p class="searchWord_af2c1">Search Docs</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_d85a9"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a class="link_a7cea  cursor-pointer" target="" href="/blog/dify/index.html"><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center">dify</div></a><a class="link_a7cea  cursor-pointer" target="" href="/blog/antd-design/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">antd-design</div></a><a class="link_a7cea  cursor-pointer" target="" href="/blog/large-screen/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">数字大屏</div></a><a class="link_a7cea  cursor-pointer" target="" href="/blog/project-plan/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">解决方案</div></a><a class="link_a7cea  cursor-pointer" target="" href="/blog/about/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于作者</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6m0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4M12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1M5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3M19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3M3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1M4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3M18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5s.2.8-.1 1.1c-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2M9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2"></path></svg></div></div></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/akira0912" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a></div></div></div></div><div class="mobileNavMenu_e7045"><div class="navScreen_ec30c  rspress-nav-screen" id="navScreen"><div class="container_c935d"><div class="navMenu_b887b"><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/blog/dify/index.html"><div class="rspress-nav-menu-item singleItem_c1154 activeItem_a28b5 text-sm font-medium mx-1.5 px-3 py-2 flex items-center">dify</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/blog/antd-design/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">antd-design</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/blog/large-screen/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">数字大屏</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/blog/project-plan/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">解决方案</div></a></div><div class="navMenuItem_e7978 w-full"><a class="link_a7cea  cursor-pointer" target="" href="/blog/about/index.html"><div class="rspress-nav-menu-item singleItem_c1154  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于作者</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_bf893 flex justify-center"></div><div class="social-links menu-item_e90a6 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/akira0912" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_a4ad0"><div><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a></div></div></div></div></div><button aria-label="mobile hamburger" class=" rspress-mobile-hamburger navHamburger_ac64c text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_af141 pt-0"><aside class="sidebar_dd719 rspress-sidebar "><div class="navTitleMask_fb17c"><div class="navBarTitle_c5f07"><a class="link_a7cea flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/blog/index.html"><div class="mr-1 min-w-8"><img src="/blog/rspress-light-logo.png" alt="logo" id="logo" class="rspress-logo dark:hidden"/><img src="/blog/rspress-dark-logo.png" alt="logo" id="logo" class="rspress-logo hidden dark:block"/></div></a></div></div><div class="rspress-scrollbar sidebarContent_da296"><nav class="pb-2"><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/blog/dify/index.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>Dify 文档中心</span></div></a><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/blog/dify/AI大模型应用调研-Dify部署.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>AI大模型应用调研-Dify部署</span></div></a><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_ac22e" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">ai-ppt</span></h2><div class="collapseContainer_d6e4e p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:12px"><div class="rspress-sidebar-item"><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/blog/dify/ai-ppt/1.生成PPT并导出.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>生成PPT并导出</span></div></a></div><div class="rspress-sidebar-item"><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/blog/dify/ai-ppt/2.市场分析-AIPPT.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>市场分析-AIPPT</span></div></a></div><div class="rspress-sidebar-item"><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/blog/dify/ai-ppt/3.AIPPT的架构设计说明.html"><div class="menuItem_ac22e mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>AIPPT的架构设计说明</span></div></a></div></div></div></section><a class="link_a7cea menuLink_bb039 cursor-pointer" target="" href="/blog/dify/生成多种类型的分析报告（类似秘塔）.html"><div class="menuItemActive_de63c mt-0.5 py-2 px-3 font-medium flex" style="font-size:14px;margin-left:0;border-radius:0 var(--rp-radius) var(--rp-radius) 0;padding-left:24px;font-weight:bold"><span>生成多种类型的分析报告（类似秘塔）</span></div></a></nav></div></aside><div class="flex-1 relative min-w-0"><div class="rspress-sidebar-menu-container "><div class="rspress-sidebar-menu"><button type="button" class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button type="button" class="flex-center ml-auto"><span class="text-sm">ON THIS PAGE</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#一工作流拆解" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">一、工作流拆解</span></a></li><li><a href="#二结点讲解" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">二、结点讲解</span></a></li><li><a href="#1chatflow-or-workflow" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">1、chatflow or workflow</span></a></li><li><a href="#2知识库" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">2、知识库</span></a></li><li><a href="#3报告内容迭代生成" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">3、报告内容迭代生成</span></a></li><li><a href="#4根据大纲和报告主题联网搜索" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">4、根据大纲和报告主题联网搜索</span></a></li><li><a href="#三输出图表" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">三、输出图表</span></a></li><li><a href="#echarts" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">echarts</span></a></li><li><a href="#svg" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">svg</span></a></li><li><a href="#四细节的优化" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">四、细节的优化</span></a></li><li><a href="#五结尾" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">五、结尾</span></a></li></ul></div></div></div><div class="content_ff766 rspress-doc-container flex"><div class="flex-1 overflow-x-auto"><div class="rspress-doc"><!--$--><p class="my-4 leading-7">不知道大家是否有用过秘塔的工作流，可以根据大纲生成不同类型的分析报告，如下图所示。本篇文章就教大家如何用Dify开发一个工作流，去复刻这个功能。</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4407203f2a24f7c898ac2bae0684ffa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=r3yAwj6s2fwE%2FIQ%2FGVTRaha0Ze8%3D" alt="image.png"/></p>
<h2 id="一工作流拆解" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">一、工作流拆解<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#一工作流拆解">#</a></h2>
<p class="my-4 leading-7">这个工作流的流程非常清晰，用户选择报告类型和报告主题 -&gt; 工作流根据类型拿到该报告的大纲 -&gt; 迭代生成每一段的内容 -&gt; 调用http，输出成pdf。如果不怕token消耗的话可以进行附加的操作：检查段落连续性、检测有图表数据的地方生成图表。 大概的工作流程如下：</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e55ca7b63f10438789a17d9e1712431c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=vLGLbtOLKsGSukcvEPBoxK%2FEpnU%3D" alt="image.png"/></p>
<h2 id="二结点讲解" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">二、结点讲解<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#二结点讲解">#</a></h2>
<h3 id="1chatflow-or-workflow" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">1、chatflow or workflow<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#1chatflow-or-workflow">#</a></h3>
<p class="my-4 leading-7">两者的区别是：chatflow有一个query，也就是用户输入的变量，主要用来进行多轮对话，workflow没有memory相关功能，偏向于自动化和批处理情景。</p>
<p class="my-4 leading-7">在这个案例中，整体大的工作流用的是chatflow，可以多次对话，其中小的联网搜索功能，是封装了一个workflow，发布成自定义工具进行调用。</p>
<h3 id="2知识库" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">2、知识库<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#2知识库">#</a></h3>
<p class="my-4 leading-7">我这里用知识库存储大纲，不同类型的大纲用<strong class="font-semibold">固定的分隔符</strong>分割，然后在创建知识库的时候，用自己选择分隔符去创建，这样就能把知识库当做一个数据库去存储一些东西，最后的效果就是每一个类型的报告的大纲会被知识库分成一个分段（如下图所示）。</p>
<p class="my-4 leading-7">当然也可以把大纲存储在会话变量或者让llm去直接生成，都是可以的。只是我这里会选择直接用秘塔的大纲去生成报告。</p>
<p class="my-4 leading-7">js</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code>//提取知识库内存储的大纲 function main({arg1}) {     const temp=arg1[0].content.split(&#x27;：\n&#x27;)     const temp2=temp[1].split(&#x27;\n&#x27;)     return {         result: temp2     } }</code></p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff8b64e03cc4849877a438208c15993~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=ankZ1TaTr9N42XJRoXcbTqBVAiQ%3D" alt="image.png"/></p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad12f23964ed491c907b4972f4a68300~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=dR2CYRtVFtUgk6xDM8XvLCaARNE%3D" alt="image.png"/></p>
<h3 id="3报告内容迭代生成" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">3、报告内容迭代生成<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#3报告内容迭代生成">#</a></h3>
<p class="my-4 leading-7">我们要把大纲提取出来，转换成一个数据，供迭代节点使用。迭代节点需要输入一个数组，输出结果也是一个数组，可以选择并行数量，但是这样可能会影响输出顺序，特别是迭代节点中包含http的情况下。</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e2b82fa765a4788bde0f0d60d7c3a42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=1gjfUhUE9GYSwxfD8TkH9egGYPQ%3D" alt="095ca6e671c6f317eb454eacfd1c9c6f.png"/></p>
<h3 id="4根据大纲和报告主题联网搜索" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">4、根据大纲和报告主题联网搜索<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#4根据大纲和报告主题联网搜索">#</a></h3>
<p class="my-4 leading-7">下面是我的提示词，用的是moonshotAPI，有联网的工具（具体的http请求怎么写可以看官网或者我之前的文章）。这个api是可以输出来源的，要用提示词进行约束。（但也不是很稳定，问过kimi客服，可能是一些内容合规的问题）</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38f978999a6641609a286e6b51139a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=srKGfs5kUs%2FF0indohHYkN6r8uE%3D" alt="9553c817b6ca4a156c6dca3f8f190f1.jpg"/></p>
<p class="my-4 leading-7">markdown</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code>##角色：你是一个专业的文章创作者，尤其擅长分工合作，能够根据大纲的要求创作其中一个部分的内容，同时保证兼顾整个大纲，做到和其他部分能够融合自然，没有冲突，注意协调性和一致性。 ##任务：首先这是一个【报告名称】，主题是：【主题】，参考完整的大纲内容：【完整大纲】，然后针对其中的【部分标题】进行创作，完成这一标题下的内容，并保证内容的专业性和严谨性。 给出具体的数据来源，数据来源用[1]、[2]类似的输出，格式是markdown链接，数据来源重复的话，输出一次来源链接即可，不要给重复的链接。 图文结合，适当输出Markdown表格，例如：在公司简介处可以输出一个公司关键里程碑的表格。 图片能获取连接的话，用Markdown链接展示。 最后返回一个markdown的文本内容，不要使用&lt;code&gt;标签，注意标题层级。 ##【完整大纲】= ##【部分标题】= ##【报告名称】= ##【主题】=</code></p>
<p class="my-4 leading-7">显示的效果：</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/423832f4790940d2812b9661ab6af8ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=MO%2FTPj6zFZmLARj0zaphzvnEw1Y%3D" alt="f7af58978799a7e0863ad5802547346.jpg"/></p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28d1a5a6400a40168e3d7ded3118c27c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=%2FqLsAJV5%2FYHLCp4seXI6PhTtEgg%3D" alt="6681467257ad690eb2e07e1a5be9c63.jpg"/></p>
<h2 id="三输出图表" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">三、输出图表<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#三输出图表">#</a></h2>
<p class="my-4 leading-7">在领导想看报告的时候，可能都有看图表的要求，表格的话非常容易，因为md支持直接输出表格格式的，在提示词里加上<strong class="font-semibold">适当输出md表格</strong>就可以。而图的话，有很多种方式，比如拿到数据让大模型生成svg代码，然后用代码转base64图片输出，或者生成echarts的options，再去渲染。最重要的还是如何拿到靠谱的数据。</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bec123191a64534b72ab84852a4c9ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=UF6s79DXq15PVrb2eaVFY%2FgAIpU%3D" alt="image.png"/></p>
<h3 id="echarts" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">echarts<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#echarts">#</a></h3>
<p class="my-4 leading-7">我们知道如果直接使用dify的聊天框，那他们的聊天框是支持直接输出echarts图表的，只要符合输出 <code> ```echarts ``` </code> 这样的格式。</p>
<p class="my-4 leading-7">js</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code> //一个示例 ‍```echarts {   &quot;title&quot;: {     &quot;text&quot;: &quot;2024年1-3月签约额及同比变化&quot;,     &quot;textStyle&quot;: {       &quot;color&quot;: &quot;#000000&quot;,       &quot;fontSize&quot;: 18     },     &quot;top&quot;: &quot;3%&quot;,     &quot;left&quot;: &quot;center&quot;   },   &quot;backgroundColor&quot;: &quot;#FFFFFF&quot;,   &quot;grid&quot;: {     &quot;top&quot;: &quot;20%&quot;,     &quot;bottom&quot;: &quot;10%&quot;   },   &quot;tooltip&quot;: {     &quot;trigger&quot;: &quot;axis&quot;,     &quot;axisPointer&quot;: {       &quot;type&quot;: &quot;shadow&quot;     }   },   &quot;legend&quot;: {     &quot;data&quot;: [&quot;签约额&quot;, &quot;同比&quot;],     &quot;top&quot;: &quot;10%&quot;,     &quot;textStyle&quot;: {       &quot;color&quot;: &quot;#000000&quot;     }   },   &quot;toolbox&quot;: {     &quot;feature&quot;: {       &quot;saveAsImage&quot;: {         &quot;show&quot;: true,         &quot;title&quot;: &quot;保存为图片&quot;       },       &quot;magicType&quot;: {         &quot;show&quot;: true,         &quot;type&quot;: [&quot;bar&quot;, &quot;line&quot;, &quot;pie&quot;],         &quot;title&quot;: {           &quot;bar&quot;: &quot;柱状图&quot;,           &quot;line&quot;: &quot;折线图&quot;,           &quot;pie&quot;: &quot;饼图&quot;         }       }     }   },   &quot;xAxis&quot;: {     &quot;type&quot;: &quot;category&quot;,     &quot;data&quot;: [&quot;2024-01&quot;, &quot;2024-02&quot;, &quot;2024-03&quot;],     &quot;axisLine&quot;: {       &quot;lineStyle&quot;: {         &quot;color&quot;: &quot;#CBDDF4&quot;       }     },     &quot;axisLabel&quot;: {       &quot;color&quot;: &quot;#000000&quot;     }   },   &quot;yAxis&quot;: [     {       &quot;type&quot;: &quot;value&quot;,       &quot;name&quot;: &quot;签约额 (元)&quot;,       &quot;position&quot;: &quot;left&quot;,       &quot;axisLine&quot;: {         &quot;lineStyle&quot;: {           &quot;color&quot;: &quot;#CBDDF4&quot;         }       },       &quot;axisLabel&quot;: {         &quot;color&quot;: &quot;#000000&quot;,         &quot;formatter&quot;: &quot;{value}&quot;       }     },     {       &quot;type&quot;: &quot;value&quot;,       &quot;name&quot;: &quot;同比 (%)&quot;,       &quot;position&quot;: &quot;right&quot;,       &quot;axisLine&quot;: {         &quot;lineStyle&quot;: {           &quot;color&quot;: &quot;#CBDDF4&quot;         }       },       &quot;axisLabel&quot;: {         &quot;color&quot;: &quot;#000000&quot;,         &quot;formatter&quot;: &quot;{value} %&quot;       }     }   ],   &quot;series&quot;: [     {       &quot;name&quot;: &quot;签约额&quot;,       &quot;type&quot;: &quot;bar&quot;,       &quot;data&quot;: [221692736, 212009193, 421231259185],       &quot;itemStyle&quot;: {         &quot;color&quot;: &quot;#ee7c4b&quot;       },       &quot;label&quot;: {         &quot;show&quot;: true,         &quot;position&quot;: &quot;top&quot;,         &quot;formatter&quot;: &quot;{c}&quot;       }     },     {       &quot;name&quot;: &quot;同比&quot;,       &quot;type&quot;: &quot;line&quot;,       &quot;yAxisIndex&quot;: 1,       &quot;data&quot;: [21.5, 12.1, 7.87],       &quot;itemStyle&quot;: {         &quot;color&quot;: &quot;#80BD95&quot;       },       &quot;label&quot;: {         &quot;show&quot;: true,         &quot;position&quot;: &quot;top&quot;,         &quot;formatter&quot;: &quot;{c}%&quot;       }     }   ] } ‍``` </code></p>
<h3 id="svg" class="mt-10 mb-2 leading-7 text-xl title_fb7eb">svg<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#svg">#</a></h3>
<p class="my-4 leading-7">生成svg代码的提示词↓</p>
<p class="my-4 leading-7">js</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code>你是一个SVG图表生成大师，可以生成美观的SVG图表，字体不重叠，间距合理。仅输出svg代码。 任务： Step 1：检查用户输入内容 检查用户输入是否包含可用于生成柱状图、饼图或折线图的数据。 如果有数据，提取横坐标（X轴）和纵坐标（Y轴）的数据，或者饼图数据，继续下一步。 如果没有数据，停止思考，输出：无。 Step 2：生成SVG图表 如果有数据，根据数据生成SVG图表，确保图表美观、间距合理。 柱状图要求： 每个柱子的高度适配他的数据值，确保柱子从Y轴底部（最小值）开始绘制。 柱子之间应有合理的间距，避免重叠。 每个柱子的填充颜色（fill属性）应不同，且颜色对比明显。 在每个柱子的顶部或旁边添加文本标签，显示具体数据值，确保文本不会超出图形边界或与其他元素重叠。 折线图要求： 折线应根据数据点动态绘制，确保线条平滑。 在每个数据点旁边添加文本标签，显示具体数据值。 饼图要求： 每个扇区的角度应根据数据值动态计算。 在每个扇区旁边添加文本标签，显示具体数据值和百分比。 控制SVG的大小，确保图表不会过大（例如，宽度不超过600px，高度不超过400px）。 Step 3：检查SVG代码 检查生成的SVG代码，确保： 文本的y坐标不会超出图形边界。 所有元素（如柱子、线条、文本）的位置和大小正确。 仅输出纯粹的SVG代码，不要输出其他文字。确保代码可以直接渲染。 关键点： 文本标签位置：确保文本标签位于柱子顶部或旁边，且不会超出边界； 颜色和间距：确保柱子颜色对比明显，且柱子之间有合理间距。 仅输出svg代码：不需要多余的解释和文本，只返回纯净的svg代码，不要给我Markdown的格式。</code></p>
<p class="my-4 leading-7">拿到输出之后先去掉开头结尾的<code> ```svg ``` </code>然后用代码节点转换成base64的链接地址</p>
<p class="my-4 leading-7">python</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code>import base64 def main(svg_string: str) -&gt; dict:     # 检查输入是否无效     if &#x27;无&#x27; in svg_string or not svg_string.strip():         return {&quot;result&quot;: &quot;&quot;}     # 将SVG编码为Base64格式     encoded_svg = base64.b64encode(svg_string.encode(&#x27;utf-8&#x27;)).decode(&#x27;utf-8&#x27;)     # 构建data URI     data_uri = f&quot;data:image/svg+xml;base64,{encoded_svg}&quot;     return {         &quot;result&quot;: data_uri,     }</code></p>
<p class="my-4 leading-7">拿到这个可访问的地址url 就可以用!(图片名称)[url]这样的md格式，直接显示出来。</p>
<p class="my-4 leading-7">总之，显示的方法有很多关键是数据的提取。然后提示词也需要调整，不然生成的svg代码会有很多很多问题，太自由了。</p>
<p class="my-4 leading-7">一个生成示例，可以看出来svg还是有点问题的。 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcbeecf2da5642268a5017dab62327c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=RJd96wsf6FcYFRT%2FnK99r6ij%2BOw%3D" alt="4a81dd7dacd37a07d7f2cf1acf5ed01.jpg"/></p>
<h2 id="四细节的优化" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">四、细节的优化<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#四细节的优化">#</a></h2>
<p class="my-4 leading-7">最后的报告转成pdf形式</p>
<p class="my-4 leading-7">js</p>
<p class="my-4 leading-7">代码解读</p>
<p class="my-4 leading-7">复制代码</p>
<p class="my-4 leading-7"><code>//一个node接口 接受md字符串 输出ppt 调用接口上传文件传给oss 获取pdf文件的网络路径 const { mdToPdf } = require(&#x27;md-to-pdf&#x27;) const axios = require(&#x27;axios&#x27;) const FormData = require(&#x27;form-data&#x27;) //不兼容 const convertToPdf = async (markdownString) =&gt; {   try {     const pdf = await mdToPdf(       { content: markdownString },       {         dest: null       }     )     if (pdf) {       const { content } = pdf       if (content) {         // 将 Uint8Array 转换为 Buffer         const buffer = Buffer.from(content)         const formData = new FormData()         formData.append(&#x27;file&#x27;, buffer, { filename: &#x27;分析报告.pdf&#x27;, contentType: &#x27;application/pdf&#x27; })         debugger         const res = await axios.post(&#x27;http://10.86.18.55:5000/files-anon&#x27;, formData, {           headers: {             ...formData.getHeaders()           }         })         return res.data.datas.url       }     }   } catch (error) {     console.error(&#x27;转换过程中发生错误：&#x27;, error)     return   } } module.exports = { convertToPdf }</code></p>
<p class="my-4 leading-7">添加一点对话开场白，给用户一点提示</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0d11292c970451081bbb947e34b2c8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=WTKQ%2FL1myHeYLELURKJCmfvC0cM%3D" alt="image.png"/> 添加标注，标记正确答案，使回复更加迅速</p>
<p class="my-4 leading-7"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a83d2f61512474a9698605e5ba2de97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1743957493&amp;x-signature=%2BfEpUPz8e5Mv3%2FVa4tF%2BDcD1yYY%3D" alt="image.png"/></p>
<h2 id="五结尾" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_fb7eb">五、结尾<a class="link_a9ef4 header-anchor" aria-hidden="true" href="#五结尾">#</a></h2>
<p class="my-4 leading-7">这个工作流还有很多需要优化的地方，生成图表的方式也有点不太稳定，欢迎大家一起交流，共同学习dify工作流的各种应用。</p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_c92d1 flex flex-col"><a class="link_a7cea pager-link_e0d2d cursor-pointer" target="" href="/blog/dify/ai-ppt/3.AIPPT的架构设计说明.html"><span class="desc_dcc01">Previous Page</span><span class="title_a3acb">AIPPT的架构设计说明</span></a></div><div class="next_c11be flex flex-col"></div></div></footer></div></div><div class="aside-container_bc5fa"><div class="flex flex-col"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">ON THIS PAGE</div><nav class="mt-1"><ul class="relative"><li><a href="#一工作流拆解" title="一、工作流拆解" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">一、工作流拆解</span></a></li><li><a href="#二结点讲解" title="二、结点讲解" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">二、结点讲解</span></a></li><li><a href="#1chatflow-or-workflow" title="1、chatflow or workflow" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">1、chatflow or workflow</span></a></li><li><a href="#2知识库" title="2、知识库" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">2、知识库</span></a></li><li><a href="#3报告内容迭代生成" title="3、报告内容迭代生成" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">3、报告内容迭代生成</span></a></li><li><a href="#4根据大纲和报告主题联网搜索" title="4、根据大纲和报告主题联网搜索" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">4、根据大纲和报告主题联网搜索</span></a></li><li><a href="#三输出图表" title="三、输出图表" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">三、输出图表</span></a></li><li><a href="#echarts" title="echarts" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">echarts</span></a></li><li><a href="#svg" title="svg" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">svg</span></a></li><li><a href="#四细节的优化" title="四、细节的优化" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">四、细节的优化</span></a></li><li><a href="#五结尾" title="五、结尾" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">五、结尾</span></a></li></ul></nav></div></div></div></div></div></div></section></div>
    <div id="search-container"></div>
  </body>
</html>
