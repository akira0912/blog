"use strict";(self.webpackChunkakira_blog=self.webpackChunkakira_blog||[]).push([["322"],{8637:function(e,n,t){t.r(n),t.d(n,{default:()=>o});var r=t(2676),i=t(453);function s(e){let n=Object.assign({h1:"h1",a:"a",p:"p",img:"img",pre:"pre",code:"code",strong:"strong"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"需求能不能直接粘贴图片到文本框中",children:["需求：能不能直接粘贴图片到文本框中",(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#需求能不能直接粘贴图片到文本框中",children:"#"})]}),"\n",(0,r.jsx)(n.p,{children:"某天上班，同事问我能不能把文本框改成可以粘贴图片到里面的。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7c2b4e21f994dd6851ea3d452d68d4b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=530&h=258&s=16760&e=png&b=eef1f4",alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:"思考了一下，这不就是需要一个富文本框吗，开始改造。"}),"\n",(0,r.jsxs)(n.p,{children:["使用了富文本WangEditor（",(0,r.jsx)(n.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fwww.wangeditor.com%2F",title:"https://www.wangeditor.com/",target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(n.a,{href:"http://www.wangeditor.com/",target:"_blank",rel:"noopener noreferrer",children:"www.wangeditor.com/"})})," ）一个配置简单开箱即用的富文本插件。"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// 导入编辑器样式\n//导入\nimport '@wangeditor/editor/dist/css/style.css';\n// 引入 css\nimport type {\n  IDomEditor,\n  IEditorConfig,\n  IToolbarConfig,\n} from '@wangeditor/editor';\nimport { Editor, Toolbar } from '@wangeditor/editor-for-react';\ntype InsertFnType = (url: string, alt: string, href: string) => void;\n// 工具栏配置\nconst toolbarConfig: Partial<IToolbarConfig> = {\n  excludeKeys: [\n    'codeBlock',\n    'group-video',\n    'bulletedList',\n    'numberedList',\n    'emotion',\n  ],\n}; // TS 语法;\n"})}),"\n",(0,r.jsx)(n.p,{children:"函数组件内"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const [editor, setEditor] = useState<IDomEditor | null>(null); // TS 语法\nconst [html, setHtml] = useState('');\n\n// 编辑器配置\nconst editorConfig: Partial<IEditorConfig> = {\n  // TS 语法\n  placeholder: '请输入内容...',\n  onCreated(editorCase: IDomEditor) {\n    setEditor(editorCase);\n  }, // 记录下 editor 实例\n  MENU_CONF: {\n    uploadImage: {\n      //这里是上传图片的接口\n      server: `${API_URL}/api-file/files-anon`,\n      fieldName: 'file',\n      headers: {\n        Authorization: `${getLocalStore('token').token_type} ${\n          getLocalStore('token').access_token\n        }`,\n      },\n      timeout: 0,\n      customInsert: (res: any, insertFn: InsertFnType) => {\n        // res 即服务端的返回结果\n        // 从 res 中找到 url alt href ，然后插入图片\n        insertFn(res.datas.url, res.datas.name, res.datas.url);\n      },\n    },\n\n    // 继续写其他配置...\n\n    //【注意】不需要修改的不用写，wangEditor 会去 merge 当前其他配置\n  },\n};\n\n//然后可以用editor?.getHtml()获取富文本的内容 用 editor.setHtml('')设置富文本内容\n"})}),"\n",(0,r.jsx)(n.p,{children:"return中的组件内容"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"\n  <ProFormDependency name={['operationType']}>\n              {({ operationType }) => {\n                if (operationType == 1) {\n                  return (\n                        <div\n                          style={{\n                            border: '1px solid #ccc',\n                            zIndex: 100,\n                            height: 400,\n                          }}\n                        >\n                          <Toolbar\n                            editor={editor}\n                            defaultConfig={toolbarConfig}\n                            mode=\"default\"\n                            style={{ borderBottom: '1px solid #ccc' }}\n                          />\n                          <Editor\n                            defaultConfig={editorConfig}\n                            value={html}\n                            onCreated={setEditor}\n                            onChange={(_editor) => {\n                              // setSaved(false);\n                              setHtml(_editor.getHtml());\n                            }}\n                            mode=\"default\"\n                            style={{ height: '300px', overflowY: 'hidden' }}\n                          />\n                        </div>\n                    </ProForm.Item>\n                  );\n                }\n                return <ProFormTextArea label=\"操作说明\" name=\"comment\" rules={[dynamicRules]} />;\n              }}\n            </ProFormDependency>\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"我们获取到的富文本内容是一串字符串，内容是html，输入这样的内容"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1474c2d8c817417d804b01b551877471~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=762&h=312&s=24216&e=png&b=ffffff",alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:"111111122222233333"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"www"})}),"\n",(0,r.jsx)(n.p,{children:"得到的字符串是"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d70ba06c63f24e18b1e398ee07bfdec2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=998&h=286&s=18664&e=png&b=202020",alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2b08ae0d6c94362870bbc800759b1d9~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1381&h=43&s=4315&e=png&b=fefcfc",alt:"image.png"})}),"\n",(0,r.jsx)(n.p,{children:"所以拿到字符串可以用dangerouslySetInnerHTML展示出来。不过展示原图可能太大，可以加一个maxWidth为100%的样式，然后点击图片预览，可以给顶层div加一个onclick监听事件，判断点击的node是不是img类型，如果是的话，就打开图片预览。"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67631cc1013a417bb455be7da8ed7dd0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=257&h=207&s=5129&e=png&b=1f1f1f",alt:"image.png"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"//点击事件：\nconst htmlClickIMG = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n  const target = e.target as HTMLImageElement;\n  if (target.nodeName === 'IMG') {\n    setPreviewImage(target.currentSrc);\n    setPreviewTitle(target.alt);\n    setTimeout(() => {\n      setPreviewVisible(true);\n    }, 0);\n  }\n};\n\n//reactnode\n<Descriptions.Item label=\"操作说明\">\n  {item.activityId === 'response' ? (\n    <div\n      onClick={htmlClickIMG}\n      dangerouslySetInnerHTML={{\n        __html: item.message || '',\n      }}\n      className={styles.imgHtml}\n    />\n  ) : (\n    <> {item.message}</>\n  )}\n</Descriptions.Item>;\n"})}),"\n",(0,r.jsx)(n.p,{children:"拿到富文本里的图片的src，引入antd的Image预览图片"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"//点击事件：\nconst htmlClickIMG = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n  const target = e.target as HTMLImageElement;\n  if (target.nodeName === 'IMG') {\n    setPreviewImage(target.currentSrc);\n    setPreviewTitle(target.alt);\n    setTimeout(() => {\n      setPreviewVisible(true);\n    }, 0);\n  }\n};\n\n//reactnode\n<Descriptions.Item label=\"操作说明\">\n  {item.activityId === 'response' ? (\n    <div\n      onClick={htmlClickIMG}\n      dangerouslySetInnerHTML={{\n        __html: item.message || '',\n      }}\n      className={styles.imgHtml}\n    />\n  ) : (\n    <> {item.message}</>\n  )}\n</Descriptions.Item>;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"<Image\n  width={600}\n  style={{ display: 'none' }}\n  alt={previewTitle}\n  src={previewImage}\n  preview={{\n    visible: previewVisible,\n    onVisibleChange: (value) => {\n      setPreviewVisible(value);\n    },\n  }}\n/>\n"})}),"\n",(0,r.jsx)(n.p,{children:"总之，使用富文本，富文本内上传图片，预览富文本中的Img图片，只要合理使用WangEditor组件库和Image都能简单的完成。后续应该会把组件再封装一层，复用起来更方便。"})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(s,{...e})}):s(e)}let o=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["project-plan%2F%E9%9C%80%E6%B1%82%EF%BC%9A%E8%83%BD%E4%B8%8D%E8%83%BD%E7%9B%B4%E6%8E%A5%E7%B2%98%E8%B4%B4%E5%9B%BE%E7%89%87%E5%88%B0%E6%96%87%E6%9C%AC%E6%A1%86%E4%B8%AD.md"]={toc:[],title:"需求：能不能直接粘贴图片到文本框中",headingTitle:"需求：能不能直接粘贴图片到文本框中",frontmatter:{}}}}]);