"use strict";(self.webpackChunkakira_blog=self.webpackChunkakira_blog||[]).push([["284"],{6014:function(n,e,t){t.r(e),t.d(e,{default:()=>p});var s=t(2676),i=t(453);function a(n){let e=Object.assign({h1:"h1",a:"a",p:"p",strong:"strong",img:"img",h2:"h2",h3:"h3",pre:"pre",code:"code",ol:"ol",li:"li"},(0,i.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"市场分析-aippt",children:["市场分析-AIPPT",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#市场分析-aippt",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["接着上篇的AIPPT继续，我们换的第二种方案是",(0,s.jsx)(e.strong,{children:"PPT低代码设计器+DIFY"}),"工作流的形式，用到的技术栈：Vue3、Typescript、Express。流程是：运用DIFY工作流的多轮对话和用户交流-》市场分析-》生成PPT大纲市和具体内容-》生成json-》在线编辑PPT-》导出PPT文件。"]}),"\n",(0,s.jsx)(e.p,{children:"项目基于PPTist写了后端服务（因为PPTist是纯前端的，需要加上后端支持），前端加了路由和接口请求，套了一层对话框，目前可以实现AI搜索网络内容后，自动生成PPT，且可在线编辑PPT文档，可在固定位置生成图表，可直接导出发送到邮箱。"}),"\n",(0,s.jsxs)(e.p,{children:["效果如下： ",(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c46aad5b1848462a85b6dce26803badb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=Ii7p0%2Fp1dLg%2F0VDaSXPAoyBNZ6I%3D",alt:"image.png"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a5b24c8ca9b415fb1e548c591ecf1ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=Ln6i0uYLxlZBaXE4PaQNVmXuhlk%3D",alt:"1bd8b4d83c8a04e197ef22154ba9125.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae2b9d1e791f4daa96a1d627888f62af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=a%2B6vcnb1xITIuma7S2qd2No2uN4%3D",alt:"c94c090ff011ec9254a5414030ecfc3.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c3c218d1c1145339e397dcfe9a6c34f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=7WNoQrv%2FkUvdV5sFL2rAqcGRqa4%3D",alt:"05e7a236d13ba5bcee1375713baeefb.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7c3dc64595e46a9b474c957ebd7b181~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=JparQkdgq%2BQpCJz045dCkITKDPE%3D",alt:"185c9cfcad4f8e2ae94addde28ff641.png"})}),"\n",(0,s.jsx)(e.p,{children:"这种DIFY与前后端结合，把AI灵活嵌入到我们的前后端项目中的方式，也是我觉得现在的AI项目最好的应用。因为DIFY能够简化数据管理和处理，集成了多种AI工具，前端可以通过API直接调用工作流，和DIFY进行交互，后端可以专注于业务逻辑处理，也可以写接口让dify调用。虽然，现在的agent平台大多数都提供iframe嵌入网页的功能，但这样并不灵活，有很多限制，所以最好还是自己去写聊天框接入。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/958e05f35f954d4c922b37187de6e3ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=qNYaM97Zez9DXOyclyI9%2FtEZhu8%3D",alt:"image.png"})}),"\n",(0,s.jsxs)(e.h2,{id:"pptist",children:["PPTist",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#pptist",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["PPTist是Github上一个6.3k star的开源前端项目",(0,s.jsx)(e.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpipipi-pikachu%2FPPTist",title:"https://github.com/pipipi-pikachu/PPTist",target:"_blank",rel:"noopener noreferrer",children:"github.com/pipipi-pika…"})]}),"\n",(0,s.jsx)(e.p,{children:"每一页PPT，其实都是一个json格式的Slide数组。每一个PPT元素，都通过JSON进行精确控制和定制。这样结构化的方式，可以很方便地生成、修改和保存PPT文件。每一个Slide对象都可能包括：幻灯片的标题、内容、样式、布局、动画，图片、视频、图表等元素都可以通过定制json对象来完成，项目中TS文件也很明确地规定了类型，可以仔细看一下。"}),"\n",(0,s.jsx)(e.p,{children:"示例：官方默认PPT页面，这个页面通过@/src/mocks/slides.ts文件里的slides对象数组控制。"}),"\n",(0,s.jsx)(e.p,{children:"所以我们的AIPPT的思路，就是让ai去生成这个json对象，我们拿到json之后就可以直接渲染出PPT进行在线编辑。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b2a3d42ee304548929bf305ca96edc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=cQxLPB80VqHkLy324Pp6UfEIy0U%3D",alt:"image.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d88a8bf3d50f4b22bef8b1c2ec5bd9a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=xWwog5l%2F4Kct6QLqF0Ah%2FS0H280%3D",alt:"image.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bf6f8683e974329a7996911f87f53c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=RcVTrwgDpEN5lZ82HYXiE%2BJ%2Bwew%3D",alt:"image.png"})}),"\n",(0,s.jsxs)(e.h2,{id:"dify工作流",children:["DIFY工作流",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#dify工作流",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["我们在项目的前端调用DIFY工作流的API，工作流大致如下图所示，本来还希望加上知识库联合搜索，因为dify自带的知识库不太好用，所以知识库的技术方案还在考虑中。 ",(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/226ee126fb59480b9e300a9bd0e2e10a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=9KLaN9Maj2wkWfM1a6fW4TLJXiw%3D",alt:"image.png"})]}),"\n",(0,s.jsxs)(e.h3,{id:"会话变量",children:["会话变量",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#会话变量",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["DIFY里面有一个会话变量，可以存储读写一些上下文数据，借助这个，我们和用户进行对轮对话。本文中的应用就是记录大纲内容，通过会话的方式可以对大纲进行反复的修改。 ",(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6379a23d595e4f56b39de8cb6b77be13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=WQaPxAPXTa5UEW99SLsIB0YBYPM%3D",alt:"image.png"})]}),"\n",(0,s.jsxs)(e.h3,{id:"问题分类器",children:["问题分类器",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#问题分类器",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"DIFY中的问题分类器可以帮助我们做意图识别，在对话中判断用户的意图，然后走对应的流程，本工作流会判断用户是从零开始生成大纲，还是要修改PPT大纲，还是需要直接生成PPT文件。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6884b56ecba474b8a584e1637fc93cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=hlALBAQgBenn%2BlF4kW5YlsiwYdg%3D",alt:"image.png"})}),"\n",(0,s.jsxs)(e.h3,{id:"联网搜索",children:["联网搜索",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#联网搜索",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"在撰写大纲内容的时候，我们需要从网络获取数据，用到了Moonshot联网搜索的API，这个功能DIFY的LLM结点并不支持，所以需要我们自己添加HTTP结点，调用后端写好的联网搜索接口。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4411d82bcb324742ac455fb19a9ca686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=3HSKEZl9qZFw8pUzYRLak%2BuR3ak%3D",alt:"image.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94a792fa07344aa0aad8996ef4913088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWtpcmEwOTEy:q75.awebp?rk3s=f64ab15b&x-expires=1743674347&x-signature=3zEITki56HyXAQsIemwtmoDWGPs%3D",alt:"image.png"})}),"\n",(0,s.jsxs)(e.h3,{id:"生成json格式的ppt元素",children:["生成JSON格式的PPT元素",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#生成json格式的ppt元素",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"大模型在输出JSON格式的回复的时候，经常会报错，要注意max-token的设置，json过长时会被截断，这样获取的json在转换时会报错。很多大模型都有指定输出格式的功能，比如moonshot可以指定输出json_object，但是在实际使用的时候，发现moonshot在输出json的时候还是有很多问题，最后决定用glm-4-plus，通过细化提示词的方式，尽量让大模型输出一个PPT的json格式。"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-markdown",children:'# Role: PPT 优化专家\n\n你是一个专业的 PPT 优化专家，能够充分利用用户提供的内容，自动优化并生成精美的 ppTist 的 json 结构，可以渲染出 ppt。\n\n## Goals\n\n- 根据用户提供的内容，进行正确的PPT分页，自动优化并生成精美的 ppTist 的 json 结构，可以渲染出 ppt。\n- 所输出的内容必须是有效的 json 格式，不能偏离格式要求。\n- 请确保 PPT 的内容准确、客观，不包含虚假信息。\n\n## Output Format\n\n````json\n{\n  "type": "ppt",\n  "content": {\n    "title": "主标题",\n    "subtitle": "副标题",\n    "content": [\n      {\n        "sectionTitle": "章节标题",\n        "subsections": [\n          {\n            "title": "子章节标题",\n            "points": ["子章节内容点1", "子章节内容点2", "子章节内容点3"]\n          },\n          {\n            "title": "另一个子章节标题",\n            "points": ["另一个子章节内容点1", "另一个子章节内容点2"]\n          }\n        ]\n      },\n      {\n        "sectionTitle": "另一个章节标题",\n        "subsections": [\n          {\n            "title": "子章节标题",\n            "points": ["子章节内容点1", "子章节内容点2"]\n          }\n        ]\n      }\n    ]\n  }\n}\n``` //\n## Constrains\n1. 检查 PPT 中的文本内容，确保每一页的内容充实，不能文字过少，正确进行分页，相关内容放在一页。\n2. 优化语言表达，使其更加简洁、清晰、有逻辑性，提高可读性。\n3. 对标题进行润色，使其更具吸引力。\n## Skills\n- 只处理与 PPT 制作相关的内容，拒绝回答与 PPT 无关的话题。\n- 所输出的内容必须是有效的 json 格式，不能偏离格式要求。\n- 请确保 PPT 的内容准确、客观，不包含虚假信息。\n## Workflow\n1. 学习 Outputformat，保证输出根据模板来。\n2. 根据输入的信息，分析出主题信息。\n3. 结合模板，输入的信息，输出 json 数据。\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\n前端的聊天框组件，在读取到\\`\\`\\`json开头 并且是json格式的内容的时候，确认需要生成PPT文件，这时候会调用PPT生成接口。\n\n````js\n  // 文字解析\n  async textFormat(chatContent: IMessage, message: Partial<IBotMsg>) {\n    chatContent.msg = message.content || ''\n    chatContent.msgType = 'text'\n    if (chatContent.msg.includes('```json') && chatContent.msg.includes('ppt')) {\n      const link = await generatePPt(chatContent.msg)\n      chatContent.msg = `PPT已生成，请点击查看 ${link}`\n    }\n    return chatContent\n  }\n"})}),"\n",(0,s.jsx)(e.p,{children:"由此可以看出来，聊天框我们可以设计为为多种类型的，img、text、json、loading等。"}),"\n",(0,s.jsxs)(e.h3,{id:"ppt内容生成",children:["PPT内容生成",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#ppt内容生成",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"后端在收到json格式的内容之后，经过格式转换和解析，一页页生成PPT元素，"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"const { homePage } = require('./page/home');\nconst { endPage } = require('./page/end');\nconst { headlinePage } = require('./page/headline');\nconst { listPage } = require('./page/list');\nconst { v4: uuidv4 } = require('uuid');\nclass AstPpt {\n  ppt;\n  constructor(ppt) {\n    this.ppt = ppt;\n  }\n  setPpt(ppt) {\n    this.ppt = ppt;\n  }\n\n  // 首页\n  homePage() {\n    return homePage(this.ppt);\n  }\n  content() {\n    const contentList = [];\n    this.ppt.content.forEach((item, index) => {\n      const headline = headlinePage(item.sectionTitle);\n      contentList.push(headline);\n      if (Array.isArray(item.subsections)) {\n        const list = item.subsections.map((subsection, subsectionIndex) => {\n          return listPage(uuidv4(), subsection.title, subsection.points);\n        });\n        contentList.push(...list);\n      }\n    });\n    return contentList;\n  }\n  // 结束页\n  endPage() {\n    return endPage(this.ppt);\n  }\n  // 生成图表\n  generateChart(echartData) {\n    if (!echartData) return [];\n    if (Object.keys(echartData).length === 0) return [];\n    const chartData = echartData;\n    chartData.id = uuidv4();\n    chartData.elements = chartData.elements.map((item) => {\n      item.id = uuidv4();\n      return item;\n    });\n    return chartData;\n  }\n  generatePpt(ppt, echartData) {\n    this.setPpt(ppt);\n    const slides = [\n      this.homePage(), // 首页\n      this.generateChart(echartData), // 图表\n      ...this.content(), // 内容\n      this.endPage(), // 结束页\n    ];\n    return slides;\n  }\n}\nmodule.exports = new AstPpt();\n"})}),"\n",(0,s.jsx)(e.p,{children:"其中一步是生成图表，我的做法是图表独立于大纲，单独生成，之后再嵌入到PPT的固定位置。比如在PPT的结尾，加上对市场的预测数据。如果有固定的工作流的话，可以在每个位置都判断一下是否有足够的数据，支持图表生成。"}),"\n",(0,s.jsx)(e.p,{children:"其实图表的生成有很多的方式："}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"DIFY支持直接输出echarts图表；"}),"\n",(0,s.jsx)(e.li,{children:"让大模型直接给svg代码；"}),"\n",(0,s.jsx)(e.li,{children:"本文给出的，生成一个PPT图表元素。等等。"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"主要的问题是缺数据支撑，而且不能保证大模型给的数据的准确性，这才是最头疼的地方。所以我们才会考虑做知识库，数据从网络和知识库两个地方抓取。"}),"\n",(0,s.jsx)(e.p,{children:"最后，项目还有很多需要优化的地方，连接本地知识库、图表的优化、PPT内容的优化、token消耗量等等，很多地方都有坑，感兴趣的朋友可以一起聊聊，后面准备做多工作流的集成，求大佬指导。感谢。"})]})}function r(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}let p=r;r.__RSPRESS_PAGE_META={},r.__RSPRESS_PAGE_META["dify%2Fai-ppt%2F2.%E5%B8%82%E5%9C%BA%E5%88%86%E6%9E%90-AIPPT.md"]={toc:[{text:"PPTist",id:"pptist",depth:2},{text:"DIFY工作流",id:"dify工作流",depth:2},{text:"会话变量",id:"会话变量",depth:3},{text:"问题分类器",id:"问题分类器",depth:3},{text:"联网搜索",id:"联网搜索",depth:3},{text:"生成JSON格式的PPT元素",id:"生成json格式的ppt元素",depth:3},{text:"PPT内容生成",id:"ppt内容生成",depth:3}],title:"市场分析-AIPPT",headingTitle:"市场分析-AIPPT",frontmatter:{}}}}]);